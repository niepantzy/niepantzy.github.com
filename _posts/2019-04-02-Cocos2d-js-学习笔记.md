---
layout:     post
title:     《Cocos2d-JS 开发之旅》学习笔记
subtitle:   cocos2d-js基础入门
date:       2019-04-02
author:     Niepan
header-img: img/cocos-bg.jpg
catalog: true
tags:
    - cocos2d
    - js
---

> 要开始学习前端知识，直接看线上业务代码三步一个坎，有JS语法的问题，也有Cocos API的问题，索性找来这本书。
>
> 本书比较适合前端小白，内容比较基础浅显，并且完全是以做一个游戏为目的展开的知识点教学，看完可以完成两个小但是完整的游戏，增强学习者的学习积极性。


# Cocos2d-JS介绍


cocos2d-x是一个支持多平台的2D手机游戏引擎，支持IOS、Android、winPhone等，cocos2d-js是cocos2d-x引擎的javascript版本，由cocos2d-x团队维护。它使用一组简化的JavaScript友好API支持完整的cocos2d-x功能。它包括两部分：cocos2d-HTML5和cocos2d-x JavaScript绑定（JSB），cocos2d-HTML5是一个纯的web JavaScript引擎，cocos2d-x JSB用于与cocos2d-HTML5共享相同API的本地应用程序。


Cocos2d-JS最大的优势就是强大的跨平台性，可以一次发布，同时实现H5游戏和原生手机游戏。同时他还有以下优点：

- 更高的开发效率
- JavaScript属于弱类型语言，语法灵活，入门简单
- 天然支持在线资源、脚本热更新

但是，Cocos2d-JS毕竟是脚本开发，跟cocos2d-x相比有两个天生的缺陷：

- JS脚本运行效率不及C++
- Cocos2d-JS的HTML5版本接口和原生接口有兼容性问题。这个就得自己踩坑了。

# 跑起我们的HelloWorld

#### Cocos2d-JS环境搭建


首先自然是要下载cocos2d-js的SDK,[cocos官网](https://cocos2d-x.org/download "官网")里现在已经把所有项目都整合到同一个包里。另外，官方把编译和部署的操作都打包成一个命令行工具：Cocos2d Console,我们可以很轻松的完成打包发布工作。

下载好SDK后解压到任意盘，然后下载其他依赖程序：python（Cocos2d Console基于python）、JDK、ant、Android SDK和Android NDK。全部安装好以后进入刚才解压的SDK目录，双击setup.py完成环境搭建。

开发IDE的话推荐WebStorm，可以很方便的配合Chrome浏览器调试代码。

#### 第一个程序 ：HelloWorld
打开命令行，切换到我们选择好的开发目录中。输入命令：

    cocos new -l js helloworld

其中：cocoss 是 Cocos2d Console的统一的命令入口，new表示新建一个项目 ， -l 表示后续的“js”s 我们需要建立的项目类型， helloworld是我们的项目名称。运行结束后，我们会看到以下画面：
![1.png](https://upload-images.jianshu.io/upload_images/1874051-2f28949c90229937.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
此时在工作目录下可以看到helloworld文件夹，这就是一个cocos2d-js游戏项目了。使用WebStorm打开这个项目工程，展开左侧项目树，鼠标右击index.html，选择Open in Browser，再选择Chrome，我们就看到了期待已久的HelloWorld：
![2.png](https://upload-images.jianshu.io/upload_images/1874051-30e813f53ddd8d47.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
![3.png](https://upload-images.jianshu.io/upload_images/1874051-0fb778499d1782a7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


#### 项目结构树
打开HelloWorld目录，我们可以看到以下的目录结构：

![4.png](https://upload-images.jianshu.io/upload_images/1874051-ba18e94a3add8af8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)




| 目录 | 介绍 |
| :------| :------ |
| frameworks | 包含cocos2d-html5引擎、cocos2d-x引擎和各个平台的项目文件 |
| -cocos2d-html5 | cocos2d-html5引擎，用于让程序在浏览器上运行 |
| -cocos2d-x | 	cocos2d-x引擎 |
| -runtime-src | 各个平台的项目文件(android、ios、win) |
| res |	项目资源文件夹 |
| src |		项目代码文件夹 |
| index.html |	HTML5 基于web应用程序的入口点 |
| main.js |	游戏入口文件，包含游戏初始化代码及启动代码.由index.html加载 |
| project.json |	工程配置文件 |

main.js主要代码介绍：
```
//设置屏幕尺寸，最后一个参数是自适应类型，后面会具体介绍
cc.view.setDesignResolutionSize(960, 640, cc.ResolutionPolicy.SHOW_ALL);
//加载进入的场景
cc.LoaderScene.preload(g_resources, function () {
cc.director.runScene(new HelloWorldScene());
}, this);
```
project.json 各参数意义说明：
```
{
    "project_type": "javascript", //项目类型

    "debugMode" : 1, //表示程序的调试级别，0表示不输出任何调试信息，1表示输出全部信息，2表示只输出严重信息
    "showFPS" : true,// 表示是否在画面左下角显示当前的帧频信息
    "frameRate" : 60,//表示限制的最大帧频，如果设定为30，那么游戏最多1秒显示30帧
    "noCache" : false,
    "id" : "gameCanvas",//必需和index.html中的canvas标签id一致，便于JS程序查找canvas对象
    "renderMode" : 0,//渲染模式。0自动选择、1强制使用canvas渲染、2强制使用webGL渲染
    "engineDir":"frameworks/cocos2d-html5",//类库路径，调试时有用，发布后无用
    "modules" : ["cocos2d"],//本项目依赖的模块
    // 列出本项目所有需要加载的JS文件，JS会顺序加载这些文件，然后再调用main.js，需要特别注意这些文件的依赖关系和先后顺序
    "jsList" : [
        "src/resource.js",
        "src/app.js"
    ]
}

```

web项目的启动流程:

    index.html
    加载CCBoot.js
    读取 project.json
    加载 resource.js, app.js等project.json中列出的文件
    运行 main.js
    加载资源
    显示游戏
# Cocos2d-JS 语法
-cc：cc在cocos-js中是一个js对象，在这里起到命名空间的作用，所有的原生类型都封装在这个命名空间中
-extend函数： cocos-js定义的一个继承函数，接收一个对象作为参数，可以扩展属性也可以重写父类方法
# Cocos2d-JS 基本元素
#### 场景（Scene）
 Cocos2d-JS 中把游戏界面拆分为多个场景，这样可以让游戏结构清晰，代码便于维护，并且有利于运行时的性能优化，场景切换时旧场景会被销毁，包含其中的图片文本都会被清除。
```
//定义场景
var HelloWorldScene = cc.Scene.extend({
    onEnter:function () {
        this._super();
        var layer = new HelloWorldLayer();
        this.addChild(layer);
    }
});
// 切换场景
cc.director.runScene(new HelloWorldScene());
```

#### 节点（Node）

节点是cocos2d中的最基础的东西，可以理解为java中的Object基类（不过在cocos中还有一个最基础的类Class，node继承自它）。所有的显示类都继承与它。它封装了一些基本操作：缩放,坐标变化，缩放变化，透明度，可见性等。**其中有一个很重要的属性：children**，表示节点的孩子，节点包含子节点，子节点又可以包含子节点，类似一个树结构。这个属性的特性是：父节点的位置、大小、可见、透明度、旋转角度等属性变化的时候子节点会跟着一并变化。

#### 层（Layer）
层在实际中运用的最多，一个典型的游戏中往往包含这些层：背景层、人物层、道具层、系统信息层。各层之间互不干扰，各自管理自己的子节点，
```
//新建一个层
var layer = new cc.Layer();
//把层添加到场景上
scene.addChild(layer);
//再把子节点添加到这个层上
layer.addChild(child)
```
cocos2d-JS提供了两个常用的Layer：

- LayerColor ：纯色的背景层
```
//创建一个宽高都为100的纯白背景层，并添加到场景，宽高缺省时默认全屏
var layerColor = new cc.LayerColor(cc.color(255,255,255),100,100);
scene.addChild(layerColor);
```
- LayerGradient ： 颜色渐变的层
```
//创建一个由红色渐变为蓝色的背景
var layerGradient= new cc.LayerGradient(cc.color(255,0,0),cc.color(0,0,255));
scene.addChild(layerGradient);
```
- 除了cocos2d-JS提供的固定Layer，我们还可以通过继承自行扩展我们需要的层。
