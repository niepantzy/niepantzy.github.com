---
layout:     post
title:      前端工作流程
subtitle:   拉手童话-前端框架工作流
date:       2019-04-08
author:     Niepan
header-img: img/loveingame.png
catalog: true
tags:
    - cocos2d
---
> 这里主要介绍前端开发过程中的各个流程，涉及到与各部门之间的合作流程等


# 解决方案

- 底层框架 cocos2d-JS
- UI：cocosStudio UI编辑器
- 特效：cocosStudio 动画编辑器，spine 骨骼，粒子效果 
- 静态数据：Excel 自有工具转化格式
- 合图：texturePacker
- 协议：protobuf



# 项目目录结构

#### 前端目录结构
![1.jpg](https://upload-images.jianshu.io/upload_images/1874051-3e0d36805735f4e4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

下面介绍一下各个目录的主要职责，这里最多只展开到二级目录，再里面的后续再做详细介绍：
- client_img、client_res、client_ui 无用目录，历史遗留，忽视；
- client_src 前端业务代码编辑目录，一般都是webstorm只加载这个目录进行开发工作。编码完成后需要调试时会通过工具将代码整体拷贝至运行目录。
- Runing 项目运行目录
- Runing/frameworks 框架代码
- Runing/res 资源目录，包括图片、音效、UI、特效等
- Runing/src 代码目录，上面的client_src 的代码在运行时就会被拷贝至这个目录中。
- tool 工具目录，里面包括生成表数据的、protobuf协议的以及拷贝等工具。
- wan webstorm 代码模板，提高撸码效率。

#### 产品目录结构

![2.jpg](https://upload-images.jianshu.io/upload_images/1874051-d437cd0ead5723b7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
![4.jpg](https://upload-images.jianshu.io/upload_images/1874051-16c095a9a4e51518.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

前端开发过程中依赖产品的内容提供主要有：
- document 静态数据表目录，用上面提到tool目录下的工具可以直接生产开发所需的js文件
- sounds 音效目录，无脑拷贝到Runing/res/sounds下程序即可引用音效
- img UI中没有使用但程序直接引用的图片目录。将Game和Platform中publish中的文件无脑拷贝至Runing/res/img即可。
- ui UI目录，存放UI编辑相关的资源，将Game和Platform中publish/resources中的文件无脑拷贝至Runing/res/ui即可。

#### 特效目录结构

![3.jpg](https://upload-images.jianshu.io/upload_images/1874051-b0a6f2c0d976a34b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

将下面两个文件夹里的特效文件无脑拷贝至Runing/res/effect中即可。
- cocosPublish CocosStudio编辑的特效文件，粒子特效文件也在里面
- spinePublish  Spine编辑的骨骼动画

#### 后端目录结构

![5.jpg](https://upload-images.jianshu.io/upload_images/1874051-351835295980186f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

与后端公用的协议文件夹，里面包括：
- proto protobuf文件，一般是后端编辑好提交，前端直接更新生成相应的js文件。
- script 工具目录，用里面的脚本将protobuf文件转化为js文件

# 工具使用
项目开发过程中会使用到的工具以及脚本这里做统一介绍

#### 生成策划表工具
1. 首先更新至最新策划表
2. 确认工具配置无误，client/tool/excel2json/config/tools.conf
3. 切换当前目录至 client/tool，输入```./client_build.py  1 ```即可完成策划表的生成工作。

#### 生成proto协议工具
1. 确认工具配置无误，proto/trunk/script/config.ini;
2. 切换至工具目录proto/trunk/script，输入```python runClientProtoc.py ```即可完成协议生成工作。

#### 生成调试环境工具
撸完代码各种工作都准备完成后就可以开始调试工作了。切换当前目录至 client/tool，输入```./client_build.py ```，这个操作主要的工作是降client_src下的文件全部拷贝至Running/src下，并且生成新的project.json（这个文件的作用在上篇讲cocos的文章中有说明）文件。

#### 后续
目前各资源拷贝还是手动，后续考虑完善工具，流程化

# 业务推进

####  前端项目代码目录结构
![6.jpg](https://upload-images.jianshu.io/upload_images/1874051-a10ea84f91d54108.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
- config 配置文件夹，存放项目的配置文件，比如服务器地址等信息
- framework 框架文件夹，这里的框架是指以cocos2d-x为基础封装出更适合我们开发使用的底层框架
- framework/forg 通用框架逻辑
- framework/serialize 序列化类库，目前存放的是protobuf相关文件
- framework/wan 更加适用于拉手童话项目的框架封装
- loadsrc 热更相关代码及资源
- logic 业务逻辑目录
- logic/ahead 目前里面放的是proto文件生成的js代码。
- logic/constants 常量目录
- logic/iap 充值支付目录
- logic/logicUtil 工具类目录
- logic/manager 管理类目录
- logic/net 网络相关
- logic/report 数据上报目录
- logic/resource 资源目录，所有代码中直接引用的资源路径都在这里先声明，做常量理解。
- logic/scene 场景目录，当前项目有三个场景
- logic/template 静态数据目录，上面说到的策划表通过工具生成的js文件就存在这里。
- logic/third_platform 第三方sdk，包括地图，分享等
- **logic/handler 消息处理目录，存放各个模块收到后端消息的处理逻辑**
- **logic/model 数据结构，存放各个模块要缓存的数据已经一些数据操作逻辑**
- **logic/ui 大头UI目录，所有业务的UI逻辑都在这里了。**

